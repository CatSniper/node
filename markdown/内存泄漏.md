## 造成内存泄漏的原因
1. 缓存
2. 队列消费不及时
3. 作用域未释放

### 缓存
在Node中，任何试图拿内存当缓存的行为都应当被限制。当然，这种限制并不是不允许使用的意思，而是要小心为之

#### 解决方案
直接将内存作为缓存的方案要十分慎重。除了限制缓存的大小外，另外要考虑的事情是，进程之间无法共享内存。如果在进程内使用缓存，这些缓存不可避免的有重复，对物理内存的使用是一种浪费。

目前较好的缓存有Redis和Memcached
https://github.com/redis/node-redis
https://github.com/3rd-Eden/memcached
### 关注队列状态
在javascript中可以通过队列来完成许多特殊的需求，如Bagpipe。队列在消费者-生产者模式中经常充当中间产物。这是一个容易忽略的情况，因为在大多数应用场景下，消费的速度远远大于生产的速度，内存泄漏不易产生，但是一旦消费速度低于生产速度，将会形成堆积。

举个实际例子，有的应用会收集日志。如果欠缺考虑，也许会采用数据库来记录日志。日志通常是海量的，数据库构建在文件系统之上，写入效率远远低于文件直接写入，于是会形成数据库写入操作的堆积

深度的解决方案应该是监控队列的长度，一旦堆积，应该通过监控系统产生报警并通知相关人员。另一个解决方案是任意异步调用都应该包含超时机制，一旦在限定的时间内未完成响应，通过回调函数传递超时异常，使得任意异步调用的回调都具备可控的响应时间，给消费者一个下限值

## 内存泄漏排查
现在已经有许多工具用于Node应用的内存泄漏：
v8-profiler, mode-heapdump,node-mtrace, dtrace,node-memwatch
